<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>SFL-885, to find the delta between the new appointment list and the old appointment list</description>
        <name>Call_FSM_ServiceAppointmnetCrewDelta</name>
        <label>Call FSM_ServiceAppointmnetCrewDelta</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <actionName>FSM_ServiceAppointmnetCrewDelta</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Delete_AR_for_old_aapointment</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>allAppointment</name>
            <value>
                <elementReference>SA_Collection</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>allAppointmentOld</name>
            <value>
                <elementReference>SA_Prior_Collection</elementReference>
            </value>
        </inputParameters>
        <nameSegment>FSM_ServiceAppointmnetCrewDelta</nameSegment>
        <offset>0</offset>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <apiVersion>64.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>SFL-885</description>
        <name>Add_Assigned_Resource_for_create_record_to_collection</name>
        <label>Add Assigned Resource for create record to collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>allAssignedResForCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>assignedResourceRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>New_SA_loop_for_create</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>SFL-885</description>
        <name>Add_Assigned_Resource_record_to_collection</name>
        <label>Add Assigned Resource record to collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>allAssignedResForCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>assignedResourceRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>allAppointments_loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>SFL-885</description>
        <name>Assign_Assigned_Resource_to_relevant_SA</name>
        <label>Assign Assigned Resource to relevant SA</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>assignedResourceRecord.ServiceAppointmentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>allAppointments_loop.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>assignedResourceRecord.ServiceResourceId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Fetch_ServResCrewmem.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>assignedResourceRecord.ServiceCrewId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>SCM_Record.ServiceCrew.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Assigned_Resource_record_to_collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>SFL-885</description>
        <name>Assign_Assigned_Resource_to_relevant_SA_for_create</name>
        <label>Assign Assigned Resource to relevant SA for create</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>assignedResourceRecord.ServiceAppointmentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>New_SA_loop_for_create.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>assignedResourceRecord.ServiceResourceId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Fetch_ServResCrewmem.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>assignedResourceRecord.ServiceCrewId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>SCM_Record.ServiceCrew.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Assigned_Resource_for_create_record_to_collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>SFL-885, this Id&apos;s will be later used to fetch all assigned resource, SA and WO share records</description>
        <name>Assign_SA_and_WO_Id_to_collection</name>
        <label>Assign SA and WO Id to collection</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>allAppointmentID</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>allAppointments_loop_for_delete.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>allAppointments_loop_for_delete</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>SFL-885, this Id&apos;s will be later used to fetch all assigned resource, SA and WO share records</description>
        <name>Assign_SA_and_WO_Id_to_collection_for_delete</name>
        <label>Assign SA and WO Id to collection for delete</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>allAppointmentID</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Old_SA_loop_for_delete.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Old_SA_loop_for_delete</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>SFL-885</description>
        <name>Assigned_Resource_Create_not_null</name>
        <label>Assigned Resource Create not null</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_Assigned_Res</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>allAssignedResForCreate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>allAssignedResForCreate</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Insert_allAssignedResForCreate</targetReference>
            </connector>
            <label>Create Assigned Res</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_SCM_EndDate_is_null</name>
        <label>Check if SCM EndDate is null</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Check_trigger_event</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>EndDate_is_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SCM_Record.EndDate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Fetch_all_appointments</targetReference>
            </connector>
            <label>EndDate is null</label>
        </rules>
        <rules>
            <name>EndDate_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SCM_Record.EndDate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Copy_1_of_Fetch_all_appointments</targetReference>
            </connector>
            <label>EndDate not null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_if_SCM_update_and_EndDate_is_null</name>
        <label>Check if SCM update and EndDate is null</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Call_FSM_ServiceAppointmnetCrewDelta</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Update_and_EndDate_is_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SCM_RecordPrior.EndDate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Fetch_all_old_appointments</targetReference>
            </connector>
            <label>Update and EndDate is null</label>
        </rules>
        <rules>
            <name>Update_and_EndDate_not_null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SCM_RecordPrior.EndDate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Copy_1_of_Fetch_all_old_appointments</targetReference>
            </connector>
            <label>Update and EndDate not null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_trigger_event</name>
        <label>Check trigger event</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Triggered_for_create</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>triggeredFor</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Create</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>SA_Collection</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>allAppointments_loop</targetReference>
            </connector>
            <label>Triggered for create</label>
        </rules>
        <rules>
            <name>Triggered_for_update</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>triggeredFor</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Update</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Check_if_SCM_update_and_EndDate_is_null</targetReference>
            </connector>
            <label>Triggered for update</label>
        </rules>
        <rules>
            <name>Triggered_for_delete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>triggeredFor</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Delete</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>SA_Collection</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>allAppointments_loop_for_delete</targetReference>
            </connector>
            <label>Triggered for delete</label>
        </rules>
    </decisions>
    <decisions>
        <description>SFL-885</description>
        <name>Create_AR_for_new_appointments</name>
        <label>Create AR for new appointments</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_AR_for_create</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Call_FSM_ServiceAppointmnetCrewDelta.allAppointmentCreate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Call_FSM_ServiceAppointmnetCrewDelta.allAppointmentCreate</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>New_SA_loop_for_create</targetReference>
            </connector>
            <label>Create AR for create</label>
        </rules>
    </decisions>
    <decisions>
        <description>SFL-885, to check if fetched Assigned resource record is null or not and deletes them if not null</description>
        <name>Delete_allAssignedresource_records</name>
        <label>Delete allAssignedresource records?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Delete_AR_records</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Fetch_all_Assigned_resource</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_allAssignedresource</targetReference>
            </connector>
            <label>Delete AR records</label>
        </rules>
    </decisions>
    <decisions>
        <description>SFL-885, to check if fetched Assigned resource record is null or not and deletes them if not null</description>
        <name>Delete_allAssignedresource_records_for_delete</name>
        <label>Delete allAssignedresource records for delete?</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Create_AR_for_new_appointments</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Delete_AR_records_for_delete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Fetch_all_Assigned_resource_for_delete</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_allAssignedresource_for_delete</targetReference>
            </connector>
            <label>Delete AR records for delete</label>
        </rules>
    </decisions>
    <decisions>
        <description>SFL-885</description>
        <name>Delete_AR_for_old_aapointment</name>
        <label>Delete AR for old aapointment</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnector>
            <targetReference>Create_AR_for_new_appointments</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Delete_AR</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Call_FSM_ServiceAppointmnetCrewDelta.allAppointmentOldDelete</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Call_FSM_ServiceAppointmnetCrewDelta.allAppointmentOldDelete</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Old_SA_loop_for_delete</targetReference>
            </connector>
            <label>Delete AR</label>
        </rules>
    </decisions>
    <description>Created as part of SFL-885</description>
    <environments>Default</environments>
    <interviewLabel>FSM Crew Member Based SA Search {!$Flow.CurrentDateTime}</interviewLabel>
    <label>FSM Crew Member Based SA Search</label>
    <loops>
        <name>allAppointments_loop</name>
        <label>allAppointments loop</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>SA_Collection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Assigned_Resource_to_relevant_SA</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Assigned_Resource_Create_not_null</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>SFL-885</description>
        <name>allAppointments_loop_for_delete</name>
        <label>allAppointments loop for delete</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>SA_Collection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_SA_and_WO_Id_to_collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Fetch_all_Assigned_resource</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>SFL-885</description>
        <name>New_SA_loop_for_create</name>
        <label>New SA loop for create</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Call_FSM_ServiceAppointmnetCrewDelta.allAppointmentCreate</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Assigned_Resource_to_relevant_SA_for_create</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Assigned_Resource_Create_not_null</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>SFL-885</description>
        <name>Old_SA_loop_for_delete</name>
        <label>Old SA loop for delete</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <collectionReference>Call_FSM_ServiceAppointmnetCrewDelta.allAppointmentOldDelete</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_SA_and_WO_Id_to_collection_for_delete</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Fetch_all_Assigned_resource_for_delete</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Insert_allAssignedResForCreate</name>
        <label>Insert allAssignedResForCreate</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <faultConnector>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <inputReference>allAssignedResForCreate</inputReference>
    </recordCreates>
    <recordDeletes>
        <description>SFL-885</description>
        <name>Delete_allAssignedresource</name>
        <label>Delete allAssignedresource</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <inputReference>Fetch_all_Assigned_resource</inputReference>
    </recordDeletes>
    <recordDeletes>
        <description>SFL-885</description>
        <name>Delete_allAssignedresource_for_delete</name>
        <label>Delete allAssignedresource for delete</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Create_AR_for_new_appointments</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <inputReference>Fetch_all_Assigned_resource_for_delete</inputReference>
    </recordDeletes>
    <recordLookups>
        <description>SFL-885</description>
        <name>Copy_1_of_Fetch_all_appointments</name>
        <label>Fetch all appointments</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_trigger_event</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>1 AND (2 OR 3 OR 4 OR 5 OR 6 OR 7) AND 8 AND 9</filterLogic>
        <filters>
            <field>FSSK__FSK_Assigned_Service_Resource__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ServResCrew</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Scheduled</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Dispatched</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>En-Route</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Onsite</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>On Hold</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Return to Site</stringValue>
            </value>
        </filters>
        <filters>
            <field>SchedStartTime</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>SCM_Record.StartDate</elementReference>
            </value>
        </filters>
        <filters>
            <field>SchedEndTime</field>
            <operator>LessThanOrEqualTo</operator>
            <value>
                <elementReference>SCM_Record.EndDate</elementReference>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>SA_Collection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ParentRecordId</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>SFL-885</description>
        <name>Copy_1_of_Fetch_all_old_appointments</name>
        <label>Fetch all old appointments</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Call_FSM_ServiceAppointmnetCrewDelta</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>1 AND (2 OR 3 OR 4 OR 5 OR 6 OR 7) AND 8 AND 9</filterLogic>
        <filters>
            <field>FSSK__FSK_Assigned_Service_Resource__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ServResCrew</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Scheduled</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Dispatched</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>En-Route</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Onsite</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>On Hold</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Return to Site</stringValue>
            </value>
        </filters>
        <filters>
            <field>SchedStartTime</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>SCM_RecordPrior.StartDate</elementReference>
            </value>
        </filters>
        <filters>
            <field>SchedEndTime</field>
            <operator>LessThanOrEqualTo</operator>
            <value>
                <elementReference>SCM_RecordPrior.EndDate</elementReference>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>SA_Prior_Collection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ParentRecordId</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>SFL-885</description>
        <name>Fetch_all_appointments</name>
        <label>Fetch all appointments</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_trigger_event</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>1 AND (2 OR 3 OR 4 OR 5 OR 6 OR 7) AND 8</filterLogic>
        <filters>
            <field>FSSK__FSK_Assigned_Service_Resource__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ServResCrew</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Scheduled</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Dispatched</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>En-Route</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Onsite</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>On Hold</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Return to Site</stringValue>
            </value>
        </filters>
        <filters>
            <field>SchedStartTime</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>SCM_Record.StartDate</elementReference>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>SA_Collection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ParentRecordId</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>SFL-885, to fetch all Assigned resource where SA Id in allAppointmentID and SR Id matches fetched SR Id</description>
        <name>Fetch_all_Assigned_resource</name>
        <label>Fetch all Assigned resource</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Delete_allAssignedresource_records</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ServiceAppointmentId</field>
            <operator>In</operator>
            <value>
                <elementReference>allAppointmentID</elementReference>
            </value>
        </filters>
        <filters>
            <field>ServiceResourceId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Fetch_ServResCrewmem.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>AssignedResource</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>SFL-885, to fetch all Assigned resource where SA Id in allAppointmentID and SR Id matches fetched SR Id</description>
        <name>Fetch_all_Assigned_resource_for_delete</name>
        <label>Fetch all Assigned resource for delete</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Delete_allAssignedresource_records_for_delete</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ServiceAppointmentId</field>
            <operator>In</operator>
            <value>
                <elementReference>allAppointmentID</elementReference>
            </value>
        </filters>
        <filters>
            <field>ServiceResourceId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Fetch_ServResCrewmem.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>AssignedResource</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>SFL-885</description>
        <name>Fetch_all_old_appointments</name>
        <label>Fetch all old appointments</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Call_FSM_ServiceAppointmnetCrewDelta</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>1 AND (2 OR 3 OR 4 OR 5 OR 6 OR 7) AND 8</filterLogic>
        <filters>
            <field>FSSK__FSK_Assigned_Service_Resource__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ServResCrew</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Scheduled</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Dispatched</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>En-Route</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Onsite</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>On Hold</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Return to Site</stringValue>
            </value>
        </filters>
        <filters>
            <field>SchedStartTime</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>SCM_RecordPrior.StartDate</elementReference>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>SA_Prior_Collection</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ParentRecordId</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>SFL-885, to query on Service resource object to get the Service resource based on Service Resource id</description>
        <name>Fetch_ServResCrewmem</name>
        <label>Fetch ServResCrewmem</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_if_SCM_EndDate_is_null</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Create_ErrorLog</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SCM_Record.ServiceResource.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>ServiceResource</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Fetch_ServResCrewmem</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <description>SFL-885</description>
        <name>Create_ErrorLog</name>
        <label>Create ErrorLog</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <flowName>ErrorLog_Subflow_Create_Record</flowName>
        <inputAssignments>
            <name>ErrorType</name>
            <value>
                <stringValue>Exception</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>FSM_ExternalId</name>
            <value>
                <elementReference>SCM_Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>FSM_FaultMessage</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>FSM_FlowName</name>
            <value>
                <stringValue>FSM Crew Member Based SA Search</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>FSM_Type</name>
            <value>
                <stringValue>Field Service</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Interface</name>
            <value>
                <stringValue>INT-003</stringValue>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <description>SFL-885, to store all the SA Id&apos;s</description>
        <name>allAppointmentID</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>allAssignedResForCreate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AssignedResource</objectType>
    </variables>
    <variables>
        <description>SFL-885, to store all the WO Id&apos;s</description>
        <name>allWoID</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>assignedResourceRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AssignedResource</objectType>
    </variables>
    <variables>
        <name>SA_Collection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <description>SFL-885, to store the old SAs assigned to the service resource</description>
        <name>SA_Prior_Collection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <description>SFL-885, to store the SCM record getting triggered</description>
        <name>SCM_Record</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceCrewMember</objectType>
    </variables>
    <variables>
        <description>SFL-885, to store the old SCM value for the triggered SCM record</description>
        <name>SCM_RecordPrior</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>ServiceCrewMember</objectType>
    </variables>
    <variables>
        <description>SFL-885, to store the service crew resource Id</description>
        <name>ServResCrew</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>triggeredFor</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
